<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Include stylesheet -->
    <link href="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.snow.css" rel="stylesheet" />

    <title>Document</title>
</head>

<body>
    <h1 style="text-align: center;">Silly Real Time Docs</h1>

    <button onclick="connect()">Connect</button>
    <button onclick="disconnect()">Disconnect</button>
    
    <input onchange="sendMsg()" id="editor"></input>

    <script src="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.js"></script>
    <script>
        const quill = new Quill('#editor', {
            theme: 'snow',
        });
    </script>
    <script>
        let socket = null

        function connect() {
            socket = new WebSocket(
                "ws://localhost/websocket")

            socket.onopen = function () {
                console.log("Connected to WebSocket server.");
            };

            socket.onmessage = function (event) {
                console.log(event.data)
                document.getElementById("editor").value = event.data
            };

            socket.onerror = function (error) {
                console.error("WebSocket Error: ", error);
            };
        }

        function sendMsg() {

            if (!socket) {
                return
            }

            if (socket.readyState == socket.OPEN) {
                let msgVal = document.getElementById('editor').value
                socket.send(msgVal)
            }
        }
        function disconnect() {
            if (!socket) {
                return
            }

            if (socket.bufferedAmount != 0) {
                console.log('theres pending data to be sent')
                return
            }

            socket.close()

        }
    </script>
</body>

</html>